"use strict";var Bo=Object.create;var Fe=Object.defineProperty;var zo=Object.getOwnPropertyDescriptor;var ko=Object.getOwnPropertyNames;var jo=Object.getPrototypeOf,_o=Object.prototype.hasOwnProperty;var ae=(e,t)=>{for(var o in t)Fe(e,o,{get:t[o],enumerable:!0})},It=(e,t,o,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of ko(t))!_o.call(e,n)&&n!==o&&Fe(e,n,{get:()=>t[n],enumerable:!(r=zo(t,n))||r.enumerable});return e};var Io=(e,t,o)=>(o=e!=null?Bo(jo(e)):{},It(t||!e||!e.__esModule?Fe(o,"default",{value:e,enumerable:!0}):o,e)),No=e=>It(Fe({},"__esModule",{value:!0}),e);var pr={};ae(pr,{Changed:()=>Ft,DESERIALIZE_MODE:()=>Ye,IsA:()=>Me,Not:()=>Lt,Pair:()=>oe,SYMBOLS:()=>fr,Types:()=>ce,Wildcard:()=>W,addComponent:()=>N,addComponents:()=>tt,addEntity:()=>ne,addPrefab:()=>Mo,archetypeHash:()=>Oe,commitRemovals:()=>Wt,createWorld:()=>uo,defineComponent:()=>et,defineDeserializer:()=>Do,defineEnterQueue:()=>ho,defineExitQueue:()=>xo,definePrefab:()=>ur,defineQuery:()=>Ce,defineRelation:()=>Dt,defineSerializer:()=>Qo,defineSystem:()=>bo,defineWorld:()=>Bt,deleteWorld:()=>fo,enableBufferedQueries:()=>yo,enableManualEntityRecycling:()=>lo,enterQuery:()=>Vt,entityExists:()=>nt,exitQuery:()=>Jt,flushRemovedEntities:()=>ao,getAllEntities:()=>mo,getDefaultSize:()=>no,getEntityComponents:()=>Pe,getRelationTargets:()=>Ae,getWorldComponents:()=>po,hasComponent:()=>I,parentArray:()=>Ut,pipe:()=>Ro,query:()=>We,registerComponent:()=>k,registerComponents:()=>Kt,registerPrefab:()=>we,registerPrefabs:()=>cr,registerQuery:()=>ge,registerWorld:()=>zt,removeComponent:()=>re,removeComponents:()=>eo,removeEntity:()=>qe,removeQuery:()=>Gt,resetChangedQuery:()=>Ht,resetGlobals:()=>Pt,resetWorld:()=>co,setDefaultSize:()=>so,setRemovedRecycleThreshold:()=>io,worlds:()=>v});module.exports=No(pr);var pt={};ae(pt,{$componentCount:()=>be,$componentMap:()=>x,$schema:()=>ft});var x=Symbol("componentMap"),be=Symbol("componentCount"),ft=Symbol("schema");var mt={};ae(mt,{$dirtyQueries:()=>L,$enterQuery:()=>qo,$exitQuery:()=>Yo,$modifier:()=>Y,$notQueries:()=>G,$queries:()=>M,$queriesHashMap:()=>V,$queryComponents:()=>he,$queryDataMap:()=>S,$querySparseSet:()=>Uo,$queueRegisters:()=>ue});var Y=Symbol("$modifier"),M=Symbol("queries"),G=Symbol("notQueries"),V=Symbol("queriesHashMap"),Uo=Symbol("querySparseSet"),ue=Symbol("queueRegisters"),S=Symbol("queryDataMap"),L=Symbol("$dirtyQueries"),he=Symbol("queryComponents"),qo=Symbol("enterQuery"),Yo=Symbol("exitQuery");var lt={};ae(lt,{$entityArray:()=>A,$entityComponents:()=>Q,$entityIndices:()=>Lo,$entityMasks:()=>$,$entitySparseSet:()=>E,$removedEntities:()=>Fo});var $=Symbol("entityMasks"),Q=Symbol("entityComponents"),E=Symbol("entitySparseSet"),A=Symbol("entityArray"),Lo=Symbol("entityIndices"),Fo=Symbol("removedEntities");var yt={};ae(yt,{$prefabComponents:()=>He,$worldToPrefab:()=>z});var He=Symbol("prefabComponents"),z=Symbol("worldToPrefab");var D=()=>{let e=[],t=[],o=i=>e[t[i]]===i;return{add:i=>{o(i)||(t[i]=e.push(i)-1)},remove:i=>{if(!o(i))return;let a=t[i],f=e.pop();f!==i&&(e[a]=f,t[f]=a)},has:o,sparse:t,dense:e,reset:()=>{e.length=0,t.length=0},sort:()=>{e.sort((i,a)=>i-a);for(let i=0;i<e.length;i++)t[e[i]]=i}}};var je=Io(require("@bitecs/utils/Uint32SparseSet"),1);var Tt=require("@bitecs/utils");var ce={i8:"i8",ui8:"ui8",ui8c:"ui8c",i16:"i16",ui16:"ui16",i32:"i32",ui32:"ui32",f32:"f32",f64:"f64",eid:"eid"},dt={i8:"Int8",ui8:"Uint8",ui8c:"Uint8Clamped",i16:"Int16",ui16:"Uint16",i32:"Int32",ui32:"Uint32",eid:"Uint32",f32:"Float32",f64:"Float64"},J={i8:Int8Array,ui8:Uint8Array,ui8c:Uint8ClampedArray,i16:Int16Array,ui16:Uint16Array,i32:Int32Array,ui32:Uint32Array,f32:Float32Array,f64:Float64Array,eid:Uint32Array},bt={uint8:2**8,uint16:2**16,uint32:2**32},Ee=Object.freeze([]);var Et={};ae(Et,{$indexBytes:()=>me,$indexType:()=>pe,$isEidType:()=>xe,$parentArray:()=>$e,$queryShadow:()=>Vo,$serializeShadow:()=>Jo,$storeArrayElementCounts:()=>Ge,$storeBase:()=>X,$storeFlattened:()=>O,$storeMaps:()=>xt,$storeRef:()=>ht,$storeSize:()=>ze,$storeSubarrays:()=>Te,$storeType:()=>gt,$subarray:()=>St,$subarrayCursors:()=>Ve,$subarrayFrom:()=>Ho,$subarrayTo:()=>Go,$tagStore:()=>fe});var ht=Symbol("storeRef"),ze=Symbol("storeSize"),xt=Symbol("storeMaps"),O=Symbol("storeFlattened"),X=Symbol("storeBase"),gt=Symbol("storeType"),Ge=Symbol("storeArrayElementCounts"),Te=Symbol("storeSubarrays"),Ve=Symbol("subarrayCursors"),St=Symbol("subarray"),Ho=Symbol("subarrayFrom"),Go=Symbol("subarrayTo"),$e=Symbol("parentArray"),fe=Symbol("tagStore"),Vo=Symbol("queryShadow"),Jo=Symbol("serializeShadow"),pe=Symbol("indexType"),me=Symbol("indexBytes"),xe=Symbol("isEidType");var Xo=e=>t=>Math.ceil(t/e)*e,Zo=Xo(4),Z={};var Je=(e,t)=>{if(ArrayBuffer.isView(e))e[t]=e.slice(0);else{let o=e[$e].slice(0);e[t]=e.map((r,n)=>{let{length:s}=e[n],u=s*n,i=u+s;return o.subarray(u,i)})}};var $t=(e,t)=>{e[O]&&e[O].forEach(o=>{ArrayBuffer.isView(o)?o[t]=0:o[t].fill(0)})},Ko=(e,t)=>{let o=t*J[e].BYTES_PER_ELEMENT,r=(0,Tt.isSabSupported)()?new SharedArrayBuffer(o):new ArrayBuffer(o),n=new J[e](r);return n[xe]=e===ce.eid,n},Ut=e=>e[$e],wo=(e,t,o)=>{let r=e[ze],n=Array(r).fill(0);n[gt]=t,n[xe]=t===ce.eid;let s=e[Ve],u=o<=bt.uint8?ce.ui8:o<=bt.uint16?ce.ui16:ce.ui32;if(!o)throw new Error("bitECS - Must define component array length");if(!J[t])throw new Error(`bitECS - Invalid component array property type ${t}`);if(!e[Te][t]){let f=e[Ge][t],m=Zo(f*r)*J[t].BYTES_PER_ELEMENT,p=(0,Tt.isSabSupported)()?new SharedArrayBuffer(m):new ArrayBuffer(m),R=new J[t](p);R[pe]=dt[u],R[me]=J[u].BYTES_PER_ELEMENT,e[Te][t]=R}let i=s[t],a=i+r*o;s[t]=a,n[$e]=e[Te][t].subarray(i,a);for(let f=0;f<r;f++){let m=o*f,p=m+o;n[f]=n[$e].subarray(m,p),n[f][pe]=dt[u],n[f][me]=J[u].BYTES_PER_ELEMENT,n[f][St]=!0}return n},Nt=e=>Array.isArray(e)&&typeof e[0]=="string"&&typeof e[1]=="number",qt=(e,t)=>{let o=Symbol("store");if(!e||!Object.keys(e).length)return Z[o]={[ze]:t,[fe]:!0,[X]:()=>Z[o]},Z[o];e=JSON.parse(JSON.stringify(e));let r={},n=u=>{let i=Object.keys(u);for(let a of i)Nt(u[a])?(r[u[a][0]]||(r[u[a][0]]=0),r[u[a][0]]+=u[a][1]):u[a]instanceof Object&&n(u[a])};n(e);let s={[ze]:t,[xt]:{},[Te]:{},[ht]:o,[Ve]:Object.keys(J).reduce((u,i)=>({...u,[i]:0}),{}),[O]:[],[Ge]:r};if(e instanceof Object&&Object.keys(e).length){let u=(i,a)=>{if(typeof i[a]=="string")i[a]=Ko(i[a],t),i[a][X]=()=>Z[o],s[O].push(i[a]);else if(Nt(i[a])){let[f,m]=i[a];i[a]=wo(s,f,m),i[a][X]=()=>Z[o],s[O].push(i[a])}else i[a]instanceof Object&&(i[a]=Object.keys(i[a]).reduce(u,i[a]));return i};return Z[o]=Object.assign(Object.keys(e).reduce(u,e),s),Z[o][X]=()=>Z[o],Z[o]}};var Oe=(e,t)=>t.sort((o,r)=>{typeof o=="function"&&o[Y]&&(o=o()[0]),typeof r=="function"&&r[Y]&&(r=r()[0]),e[x].has(o)||k(e,o),e[x].has(r)||k(e,r);let n=e[x].get(o),s=e[x].get(r);return n.id>s.id?1:-1}).reduce((o,r)=>{let n;typeof r=="function"&&r[Y]&&(n=r()[1],r=r()[0]),e[x].has(r)||k(e,r);let s=e[x].get(r);return n?o+=`-${n}(${s.id})`:o+=`-${s.id}`,o},"");var Ot={};ae(Ot,{$archetypes:()=>ke,$bitflag:()=>F,$bufferQueries:()=>_,$localEntities:()=>K,$localEntityLookup:()=>H,$manualEntityRecycling:()=>j,$size:()=>P});var P=Symbol("size"),F=Symbol("bitflag"),ke=Symbol("archetypes"),K=Symbol("localEntities"),H=Symbol("localEntityLookup"),j=Symbol("manualEntityRecycling"),_=Symbol("bufferQueries");var _e=[];function Yt(e,t){let o=()=>[e,t];return o[Y]=!0,o}var Lt=e=>Yt(e,"not");var Ft=e=>Yt(e,"changed");function er(...e){return function(){return e}}function tr(...e){return function(){return e}}function or(...e){return function(){return e}}var ge=(e,t)=>{if(e[S].has(t))return;let o=[],r=[],n=[];t[he].forEach(c=>{if(typeof c=="function"&&c[Y]){let[h,q]=c();e[x].has(h)||k(e,h),q==="not"&&r.push(h),q==="changed"&&(n.push(h),o.push(h))}else e[x].has(c)||k(e,c),o.push(c)});let s=c=>e[x].get(c),u=o.concat(r).map(s),i;if(e[_]){let c=e[P]===-1?1e5:e[P]*2;i=je.default.create(1024,c>1024?c:1024)}else i=D();let a=[],f=[],m=D(),p=[D()],R=[D()],U=u.map(c=>c.generationId).reduce((c,h)=>(c.includes(h)||c.push(h),c),[]),d=(c,h)=>(c[h.generationId]||(c[h.generationId]=0),c[h.generationId]|=h.bitflag,c),g=o.map(s).reduce(d,{}),ye=r.map(s).reduce(d,{}),y=u.reduce(d,{}),de=o.filter(c=>!c[fe]).map(c=>Object.getOwnPropertySymbols(c).includes(O)?c[O]:[c]).reduce((c,h)=>c.concat(h),[]),T=Object.assign(i,{archetypes:a,changed:f,components:o,notComponents:r,changedComponents:n,allComponents:u,masks:g,notMasks:ye,hasMasks:y,generations:U,flatProps:de,toRemove:m,enterQueues:p,exitQueues:R,shadows:[],query:t});e[S].set(t,T),e[M].add(T);let l=Oe(e,t[he]);e[V].set(l,T),u.forEach(c=>{c.queries.add(T)}),r.length&&e[G].add(T),t[ue].forEach(c=>c(e));for(let c=0;c<Xt();c++){if(!e[E].has(c)||I(e,Se,c))continue;Qe(e,T,c)&&De(T,c)}},rr=(e,t)=>{let o=Symbol(),r=e.flatProps[t];return Je(r,o),e.shadows[t]=r[o],r[o]},nr=(e,t)=>{t&&(e.changed=[]);let{flatProps:o,shadows:r}=e;for(let n=0;n<e.dense.length;n++){let s=e.dense[n],u=!1;for(let i=0;i<o.length;i++){let a=o[i],f=r[i]||rr(e,i);if(ArrayBuffer.isView(a[s])){for(let m=0;m<a[s].length;m++)if(a[s][m]!==f[s][m]){u=!0;break}f[s].set(a[s])}else a[s]!==f[s]&&(u=!0,f[s]=a[s])}u&&e.changed.push(s)}return e.changed},sr=(e,t)=>e.concat(t),Ct=e=>t=>t.filter(o=>o.name===e().constructor.name).reduce(sr),Br=Ct(er),zr=Ct(tr),kr=Ct(or),Ce=e=>{if(e===void 0){let o=function(r){return r[_]?new Uint32Array(r[A]):Array.from(r[A])};return o[he]=e,o[ue]=[],o}let t=function(o,r=!0){let n=o[S].get(t);return Wt(o),n.changedComponents.length?nr(n,r):n.changedComponents.length?n.changed.dense:o[_]?n.dense:Array.from(n.dense)};return t[he]=e,t[ue]=[],_e.push(t),v.forEach(o=>ge(o,t)),t};function We(e,t){if(Array.isArray(t)){let o=t,r=Oe(e,o),n=e[V].get(r);return n?n.query(e):Ce(o)(e)}else{let o=t;return e[_]?new Uint32Array(o(e)):Array.from(o(e))}}var Qe=(e,t,o)=>{let{masks:r,notMasks:n,generations:s}=t;for(let u=0;u<s.length;u++){let i=s[u],a=r[i],f=n[i],m=e[$][i][o];if(f&&m&f||a&&(m&a)!==a)return!1}return!0};var De=(e,t)=>{e.toRemove.remove(t);for(let o=0;o<e.enterQueues.length;o++)e.enterQueues[o].add(t);for(let o=0;o<e.exitQueues.length;o++)e.exitQueues[o].remove(t);e.dense instanceof Uint32Array?je.default.add(e,t):e.add(t)},ir=e=>{for(let t=e.toRemove.dense.length-1;t>=0;t--){let o=e.toRemove.dense[t];e.toRemove.remove(o),e.dense instanceof Uint32Array?je.default.remove(e,o):e.remove(o)}},Wt=e=>{e[L].size&&(e[L].forEach(ir),e[L].clear())},Ie=(e,t,o)=>{if(!(!(e[_]?je.default.has(t,o):t.has(o))||t.toRemove.has(o))){t.toRemove.add(o),e[L].add(t);for(let n=0;n<t.exitQueues.length;n++)t.exitQueues[n].add(o);for(let n=0;n<t.enterQueues.length;n++)t.enterQueues[n].remove(o)}},Ht=(e,t)=>{let o=e[S].get(t);o.changed=[]},Gt=(e,t)=>{let o=e[S].get(t);e[M].delete(o),e[S].delete(t);let r=Oe(e,t[he]);e[V].delete(r)},Vt=e=>t=>{t[S].has(e)||ge(t,e);let o=t[S].get(e);if(o.enterQueues[0].dense.length===0)return Ee;{let r=o.enterQueues[0].dense.slice();return o.enterQueues[0].reset(),r}},Jt=e=>t=>{t[S].has(e)||ge(t,e);let o=t[S].get(e);if(o.exitQueues[0].dense.length===0)return Ee;{let r=o.exitQueues[0].dense.slice();return o.exitQueues[0].reset(),r}};var w=(e,t,o)=>Object.defineProperty(e,t,{value:o,enumerable:!1,writable:!0,configurable:!0}),Xe=(e,t)=>{let o={enumerable:!1,writable:!0,configurable:!0};Object.defineProperties(e,Reflect.ownKeys(t).reduce((r,n)=>Object.assign(r,{[n]:{value:t[n],...o}}),{}))};var Qt={};ae(Qt,{$autoRemoveSubject:()=>Ue,$exclusiveRelation:()=>Ne,$initStore:()=>Ke,$isPairComponent:()=>le,$onTargetRemoved:()=>Re,$pairTarget:()=>C,$pairsMap:()=>Ze,$relation:()=>ee,$relationTargetEntities:()=>te});var Ze=Symbol("pairsMap"),le=Symbol("isPairComponent"),ee=Symbol("relation"),C=Symbol("pairTarget"),Re=Symbol("onTargetRemoved"),Ne=Symbol("exclusiveRelation"),Ue=Symbol("autoRemoveSubject"),te=Symbol("relationTargetEntities"),Ke=Symbol("initStore");function Zt(e,t,o,r){if(!o.has(r)){let n=t();w(n,le,!0),w(n,ee,e),w(n,C,r),o.set(r,n)}return o.get(r)}var Dt=e=>{let t=e?.initStore||(()=>({})),o=new Map,r=function(n){if(n===void 0)throw Error("Relation target is undefined");return n==="*"&&(n=W),Zt(r,t,o,n)};return w(r,Ze,o),w(r,Ke,t),w(r,Ne,e&&e.exclusive),w(r,Ue,e&&e.autoRemoveSubject),w(r,Re,e?e.onTargetRemoved:void 0),r},oe=(e,t)=>{if(e===void 0)throw Error("Relation is undefined");if(t===void 0)throw Error("Relation target is undefined");t==="*"&&(t=W);let o=e[Ze],r=e[Ke];return Zt(e,r,o,t)},W=Dt(),Me=Dt(),Ae=(e,t,o)=>{let r=Pe(e,o),n=[];for(let s of r)if(s[ee]===t&&s[C]!==W)if(typeof s[C]=="object"&&s[C][z]){let u=s[C][z].get(e);u==null&&(u=we(e,s[C])),n.push(u)}else n.push(s[C]);return n};var et=(e={},t)=>{let o=qt(e,t||ot());return e&&Object.keys(e).length&&(o[ft]=e),o},k=(e,t)=>{if(!t)throw new Error("bitECS - Cannot register null or undefined component");let o=new Set,r=new Set,n=new Set;e[M].forEach(u=>{u.allComponents.includes(t)&&o.add(u)});let s={id:e[be]++,generationId:e[$].length-1,bitflag:e[F],ref:t,queries:o,notQueries:r,changedQueries:n};e[x].set(t,s),to(e)},Kt=(e,t)=>{t.forEach(o=>k(e,o))},I=(e,t,o)=>{let r=e[x].get(t);if(!r)return!1;let{generationId:n,bitflag:s}=r;return(e[$][n][o]&s)===s},wt=(e,t,o)=>{o instanceof Object&&(o=o[z].get(e)),N(e,Me(o),t);let r=Pe(e,o);for(let s of r){if(s===Se)continue;N(e,s,t);let u=Object.keys(s);for(let i of u)s[i][t]=s[i][o]}let n=Ae(e,Me,o);for(let s of n)wt(e,t,s)},N=(e,t,o,r=!1)=>{if(!Rt(e,o))throw new Error("bitECS - entity does not exist in the world.");if(e[x].has(t)||k(e,t),I(e,t,o))return;let n=e[x].get(t),{generationId:s,bitflag:u,queries:i}=n;if(e[$][s][o]|=u,I(e,Se,o)||i.forEach(a=>{a.toRemove.remove(o),Qe(e,a,o)?De(a,o):Ie(e,a,o)}),e[Q].get(o).add(t),r&&$t(t,o),t[le]){let a=t[ee];N(e,oe(a,W),o);let f=t[C];if(N(e,oe(W,f),o),a[Ne]===!0&&f!==W){let m=Ae(e,a,o)[0];m&&m!==f&&re(e,a(m),o)}if(e[te].add(f),a===Me){let m=Ae(e,Me,o);for(let p of m)wt(e,o,p)}}},tt=(e,t,o,r=!1)=>{t.forEach(n=>N(e,n,o,r))},re=(e,t,o,r=!0)=>{if(!Rt(e,o))throw new Error("bitECS - entity does not exist in the world.");if(!I(e,t,o))return;let n=e[x].get(t),{generationId:s,bitflag:u,queries:i}=n;if(e[$][s][o]&=~u,i.forEach(a=>{a.toRemove.remove(o),Qe(e,a,o)?De(a,o):Ie(e,a,o)}),e[Q].get(o).delete(t),r&&$t(t,o),t[le]){We(e,[W(o)]).length===0&&e[te].remove(o);let a=t[C];re(e,oe(W,a),o);let f=t[ee];Ae(e,f,o).length===0&&re(e,oe(f,W),o)}},eo=(e,t,o,r=!0)=>{t.forEach(n=>re(e,n,o,r))};var st=1e5,Mt=0,it=st,ot=()=>it,Be=[],ve=[],rt=[],ar=()=>{if(ve.length===0)for(;Be.length>0;)ve.push(Be.pop());if(ve.length===0)throw new Error("Queue is empty");return ve.pop()},oo=()=>Be.length+ve.length,ro=.01,At=ro,Pt=()=>{it=st,Mt=0,At=ro,Be.length=0,ve.length=0,rt.length=0,_e.length=0,v.length=0},no=()=>st,so=e=>{st=e,Pt(),it=e},io=e=>{At=e},Xt=()=>Mt;var vt=new Map,ao=e=>{if(!e[j])throw new Error("bitECS - cannot flush removed entities, enable feature with the enableManualEntityRecycling function");Be.push(...rt),rt.length=0},Se=et(),ne=e=>{let t;if(e[j]&&oo()>0||!e[j]&&oo()>Math.round(it*At)?t=ar():t=Mt++,e[P]!==-1&&e[E].dense.length>=e[P])throw new Error("bitECS - max entities reached");return e[E].add(t),vt.set(t,e),e[G].forEach(o=>{Qe(e,o,t)&&De(o,t)}),e[Q].set(t,new Set),t},qe=(e,t)=>{if(e[E].has(t)){if(e[te].has(t)){for(let o of We(e,[oe(W,t)]))if(nt(e,o)){re(e,oe(W,t),o);for(let r of e[Q].get(o)){if(!r[le]||!nt(e,o))continue;let n=r[ee];r[C]===t&&(re(e,r,o),n[Ue]&&qe(e,o),n[Re]&&n[Re](e,o,t))}}}for(let o of e[M])Ie(e,o,t);e[j]?rt.push(t):Be.push(t),e[E].remove(t),e[Q].delete(t),e[K].delete(e[H].get(t)),e[H].delete(t);for(let o=0;o<e[$].length;o++)e[$][o][t]=0}},Pe=(e,t)=>{if(t===void 0)throw new Error("bitECS - entity is undefined.");if(!e[E].has(t))throw new Error("bitECS - entity does not exist in the world.");return Array.from(e[Q].get(t))},nt=(e,t)=>e[E].has(t);var v=[];function Bt(...e){let t=typeof e[0]=="object"?e[0]:{},o=typeof e[0]=="number"?e[0]:typeof e[1]=="number"?e[1]:-1,r=D();return Xe(t,{[P]:o,[$]:[o===-1?new Array:new Array(o)],[Q]:new Map,[ke]:[],[E]:r,[A]:r.dense,[F]:1,[x]:new Map,[be]:0,[S]:new Map,[M]:new Set,[V]:new Map,[G]:new Set,[L]:new Set,[K]:new Map,[H]:new Map,[j]:!1,[te]:D()}),t}function zt(e){v.push(e),_e.forEach(t=>ge(e,t))}function uo(...e){let t=Bt(...e);return zt(t),t}var co=(e,t=ot())=>(e[P]=t,e[A]&&e[A].forEach(o=>qe(e,o)),e[$]=[t===-1?new Array:new Array(t)],e[Q]=new Map,e[ke]=[],e[E]=D(),e[A]=e[E].dense,e[F]=1,e[x]=new Map,e[be]=0,e[S]=new Map,e[M]=new Set,e[V]=new Map,e[G]=new Set,e[L]=new Set,e[K]=new Map,e[H]=new Map,e[j]=!1,e[_]=!1,e),fo=e=>{let t=e;delete t[P],delete t[$],delete t[Q],delete t[ke],delete t[E],delete t[A],delete t[F],delete t[x],delete t[be],delete t[S],delete t[M],delete t[V],delete t[G],delete t[L],delete t[K],delete t[H],delete t[te],delete t[j],delete t[_];let o=v.indexOf(e);o!==-1&&v.splice(o,1)},po=e=>Array.from(e[x].keys()),mo=e=>e[E].dense.slice(0),to=e=>{let t=e[P];e[F]*=2,e[F]>=2**31&&(e[F]=1,e[$].push(t===-1?new Array:new Array(t)))},Rt=(e,t)=>e[E].has(t),lo=e=>(e[j]=!0,e),yo=e=>(e[_]=!0,e);var bo=e=>(t,...o)=>(e(t,...o),t);function ho(e){let t=typeof e=="function"?e:Ce(e),o=-1,r=s=>{let u=s[S].get(t);u&&(o=u.enterQueues.push(D())-1)};for(let s of v)r(s);let n=(s,u=!0)=>{let i=s[S].get(t);if(i.enterQueues[o].dense.length===0)return Ee;{let a=i.enterQueues[o].dense.slice();return u&&i.enterQueues[o].reset(),a}};return t[ue].push(r),n}function xo(e){let t=typeof e=="function"?e:Ce(e),o=-1,r=s=>{let u=s[S].get(t);u&&(o=u.exitQueues.push(D())-1)};for(let s of v)r(s);let n=(s,u=!0)=>{let i=s[S].get(t);if(o===-1&&(o=i.exitQueues.push(D())-1),i.exitQueues[o].dense.length===0)return Ee;{let a=i.exitQueues[o].dense.slice();return u&&i.exitQueues[o].reset(),a}};return t[ue].push(r),n}var Ye={REPLACE:0,APPEND:1,MAP:2},at=!1;var go=(e,t)=>e.concat(t),Oo=e=>t=>!e(t),kt=e=>e[O],jt=kt,So=Oo(jt),Co=e=>typeof e=="function"&&e[Y],Eo=Oo(Co),To=e=>Co(e)&&e()[1]==="changed",Wo=e=>Object.getOwnPropertySymbols(e).includes(x),$o=e=>e()[0],ut=e=>{if(Wo(e))return[[],new Map];let t=e.filter(Eo).filter(jt).map(kt).reduce(go,[]),o=e.filter(To).map($o).filter(jt).map(kt).reduce(go,[]),r=e.filter(Eo).filter(So),n=e.filter(To).map($o).filter(So),s=[...t,...r,...o,...n],u=[...o,...n].reduce((i,a)=>{let f=Symbol();return Je(a,f),i.set(a,f),i},new Map);return[s,u]},Qo=(e,t=2e7)=>{let o=Wo(e),[r,n]=ut(e),s=new ArrayBuffer(t),u=new DataView(s),i=new Map;return f=>{at&&([r,n]=ut(e),at=!1),o&&(r=[],e[x].forEach((U,d)=>{d[O]?r.push(...d[O]):r.push(d)}));let m;Object.getOwnPropertySymbols(f).includes(x)?(m=f,f=f[A]):m=vt.get(f[0]);let p=0;if(!f.length)return s.slice(0,p);let R=new Map;for(let U=0;U<r.length;U++){let d=r[U],g=d[X](),ye=n.get(d),y=ye?d[ye]:null;R.has(g)||R.set(g,new Map),u.setUint8(p,U),p+=1;let de=p;p+=4;let b=0;for(let T=0;T<f.length;T++){let l=f[T],c=i.get(l);c||(c=i.set(l,new Set).get(l)),c.add(l);let h=y&&R.get(g).get(l)||!c.has(g)&&I(m,g,l);if(R.get(g).set(l,h),h)c.add(g);else if(!I(m,g,l)){c.delete(g);continue}let q=p;if(u.setUint32(p,l),p+=4,d[fe]){b++;continue}if(ArrayBuffer.isView(d[l])){let se=d[l].constructor.name.replace("Array",""),Le=d[l][pe],_t=d[l][me],Ao=p;p+=_t;let ct=0;for(let ie=0;ie<d[l].length;ie++){if(y){let vo=y[l][ie]!==d[l][ie];if(y[l][ie]=d[l][ie],!vo&&!h)continue}u[`set${Le}`](p,ie),p+=_t;let Po=d[l][ie];u[`set${se}`](p,Po),p+=d[l].BYTES_PER_ELEMENT,ct++}if(ct>0)u[`set${Le}`](Ao,ct),b++;else{p=q;continue}}else{if(y){let Le=y[l]!==d[l];if(y[l]=d[l],!Le&&!h){p=q;continue}}let se=d.constructor.name.replace("Array","");u[`set${se}`](p,d[l]),p+=d.BYTES_PER_ELEMENT,b++}}b>0?u.setUint32(de,b):p-=5}return s.slice(0,p)}},B=new Map,Do=e=>{let t=Object.getOwnPropertySymbols(e).includes(x),[o]=ut(e),r=new Set;return(s,u,i=0)=>{B.clear(),at&&([o]=ut(e),at=!1),t&&(o=[],e[x].forEach((U,d)=>{d[O]?o.push(...d[O]):o.push(d)}));let a=s[K],f=s[H],m=new DataView(u),p=0;for(;p<u.byteLength;){let U=m.getUint8(p);p+=1;let d=m.getUint32(p);p+=4;let g=o[U];for(let ye=0;ye<d;ye++){let y=m.getUint32(p);if(p+=4,i===Ye.MAP)if(a.has(y))y=a.get(y);else if(B.has(y))y=B.get(y);else{let b=ne(s);a.set(y,b),f.set(b,y),B.set(y,b),y=b}if(i===Ye.APPEND||i===Ye.REPLACE&&!s[E].has(y)){let b=B.get(y)||ne(s);B.set(y,b),y=b}let de=g[X]();if(I(s,de,y)||N(s,de,y),r.add(y),!de[fe])if(ArrayBuffer.isView(g[y])){let b=g[y],T=m[`get${b[pe]}`](p);p+=b[me];for(let l=0;l<T;l++){let c=m[`get${b[pe]}`](p);p+=b[me];let h=m[`get${b.constructor.name.replace("Array","")}`](p);if(p+=b.BYTES_PER_ELEMENT,g[xe]){let q;if(a.has(h))q=a.get(h);else if(B.has(h))q=B.get(h);else{let se=ne(s);a.set(h,se),f.set(se,h),B.set(h,se),q=se}g[y][c]=q}else g[y][c]=h}}else{let b=m[`get${g.constructor.name.replace("Array","")}`](p);if(p+=g.BYTES_PER_ELEMENT,g[xe]){let T;if(a.has(b))T=a.get(b);else if(B.has(b))T=B.get(b);else{let l=ne(s);a.set(b,l),f.set(l,b),B.set(b,l),T=l}g[y]=T}else g[y]=b}}}let R=Array.from(r);return r.clear(),R}};var Ro=(...e)=>t=>{let o=t;for(let r=0;r<e.length;r++){let n=e[r];o=n(o)}return o};var ur=(e=[])=>{let t={};return Xe(t,{[He]:e,[z]:new Map}),t},we=(e,t)=>{if(t[z].has(e))return t[z].get(e);let o=Mo(e);return tt(e,t[He],o),t[z].set(e,o),o},cr=(e,t)=>t.map(o=>we(e,o)),Mo=e=>{let t=ne(e);return N(e,Se,t),t};var fr={...Ot,...lt,...pt,...mt,...Et,...Qt,...yt};0&&(module.exports={Changed,DESERIALIZE_MODE,IsA,Not,Pair,SYMBOLS,Types,Wildcard,addComponent,addComponents,addEntity,addPrefab,archetypeHash,commitRemovals,createWorld,defineComponent,defineDeserializer,defineEnterQueue,defineExitQueue,definePrefab,defineQuery,defineRelation,defineSerializer,defineSystem,defineWorld,deleteWorld,enableBufferedQueries,enableManualEntityRecycling,enterQuery,entityExists,exitQuery,flushRemovedEntities,getAllEntities,getDefaultSize,getEntityComponents,getRelationTargets,getWorldComponents,hasComponent,parentArray,pipe,query,registerComponent,registerComponents,registerPrefab,registerPrefabs,registerQuery,registerWorld,removeComponent,removeComponents,removeEntity,removeQuery,resetChangedQuery,resetGlobals,resetWorld,setDefaultSize,setRemovedRecycleThreshold,worlds});
